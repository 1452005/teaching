<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/go.min.js"></script>
	<link rel="stylesheet" type="text/css" href="../../stylesheets/styles.css" media="screen">
	<link rel="stylesheet" type="text/css" href="../..stylesheets/github-light.css" media="screen">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->


    <title>TP6 DataViz Lyon1 M2 2017</title>
</head>

<body>
		<!-- for highlight.js -->
		<script>hljs.initHighlightingOnLoad();</script>
		<div class="wrapper">
      <header>
			<h1>TP6 DataViz: Force-directed graphs avec D3.js</h1>
			<p>Université Lyon 1, Master 2, 2017</p>

      </header>

			<section>
				<h3>Objectif du TP</h3>

				<p>Nous nous inspirerons de la visualisation du bipartisme du Sénat américain</p>

        <img src="http://b-i.forbesimg.com/ericaswallow/files/2013/11/4kDokyz.jpg" width="300px">

				<p>pour visualiser le bipartisme de l'assemblée nationale française en 2015. Chaque noeud représente un homme politique. La force entre les liens correspond au nombre de fois où ils ont été d'accord sur un vote (soit tous les deux pour, soit tous les deux contres).</p>

				<img src="images/solutiontp6.png" width="600px">
				<br>

				<h4>0. Fork de l'exemple des Miserables</h4>
					<p>Forkez <a href="http://blockbuilder.org/nbonneel/91f6d433810029851e170ba668436340">l'exemple de visualisation D3</a> des relations entre les personnages des Misérables. Cet exemple inclut 2 fichiers supplémentaires: scrutins.json et acteurs_simple2.json. <br>
					Le premier fichier contient tous les votes de l'assemblée depuis 2012. Cela inclut pour chaque vote et pour chaque parti, l'ensemble des personnes ayant voté pour, ou ayant voté contre (ou s'étant éventuellement abstenus -- nous les ignorerons ici). L'ensemble des acteurs politiques et le nom de leur parti est codé par une référence. <br>
					Le second fichier contient ainsi l'ensemble des références concernant les acteurs politiques (donnant ainsi leur nom, prénom, et autres données personnelles), ainsi que les partis politiques. Le second fichier ne sera utile que pour la partie optionnelle du TP.</p>

				<h4> 1. Explorez les fichiers JSON</h4>
					<p> Utilisez un viewer de fichiers JSON (e.g., l'interface web <a href="http://jsonviewer.stack.hu/">JSON Viewer</a>) pour explorer rapidement les deux fichiers JSON.
					Les données qui nous interesseront dans scrutins.json incluent les champs <code>scrutins/scrutin/{#ID_scrutin}/ventilationVotes/organe/groupes/groupe/{#ID_groupe}/vote/decompteNominatif/{pours|contres}/votant/{#ID_votant}/acteurRef</code> où #ID_scrutin represente le scrutin qui a recu les votes, ID_groupe identifie un parti politique et ID_votant identifie un membre de l'assemblée nationale ; <code>scrutins/scrutin/{#ID_scrutin}/dateScrutin</code> pour connaitre la date du scrutin ; <code>scrutins/scrutin/{#ID_scrutin}/ventilationVotes/organe/groupes/groupe/{#ID_groupe}/organeRef</code> qui indique le code du parti. La date du premier scrutin s'obtient en accedant à <code>graph.scrutins.scrutin["0"].dateScrutin</code>.<br />
					Les données qui nous interesseront dans acteurs_simple2.json incluent les champs <code>export/acteurs/acteur/{#ID_acteur}/uid/#text</code> qui fournit l'identifiant de chaque membre de l'assemblée nationale et correspond au #ID_votant/acteurRef de scrutins.json ; <code>export/acteurs/acteur/{#ID_acteur}/etatCivil/ident/{prenom|nom}</code> qui donne l'état civil du votant ; <code>export/organes/organe/{#ID_organe}/uid</code> qui fournit l'identifiant des partis politiques et correspond au #ID_groupe/organeRef de scrutins.json ; export/organes/organe/libelle qui donne le nom du parti politique en question.
					</p>
					
				<h4>2. Adaptez la fonction de création de graphe</h4>
					<p> Nous ne nous interesserons qu'aux scrutins de 2015. Itérez sur tous les scrutins, et testez leur date pour ne conserver que ceux de 2015. Nous pourrons utiliser la fonction <a href="https://docs.microsoft.com/fr-fr/scripting/javascript/reference/getfullyear-method-date-javascript">getFullYear() de Date</a>. Pour chacun de ces scrutins, itérez sur les groupes. Stockez dans un tableau temporaire les pours et contres de chaque scrutin (et non de chaque groupe!), afin de pouvoir corréler les votes entre les acteurs de partis différents, ainsi que le nom de tous les acteurs en jeu. Vous pourrez utiliser la fonction <a href="https://www.w3schools.com/jsref/jsref_concat_array.asp">concat()</a> afin de concatener les tableaux de pours et contres.
					Aidez-vous d'un dictionnaire pour compter les votes pour et contre de chaque paire d'acteurs, en iterant sur ce tableau temporaire (en itérant deux fois sur les pours, puis en iterant deux fois sur les contres). On pourra utiliser une fonction de hashage arbitraire qui combine les deux acteurs de la paire -- par exemple en concatenant leurs identifiants. Pour incrémenter une valeur possiblement inexistante dans le dictionnaire, on pourra utiliser <code>monDictionnaire[clef] = ++monDictionnaire[clef]||0;</code> Ainsi, une valeur "undefined" aura une valeur par défaut de 0. A noter que si un acteur A a voté la même chose que l'acteur B, alors B a voté pareil que A... il n'est donc pas nécéssaire de compter ces deux cas differemment.
					Pour l'instant, nous considererons uniquement les identifiants des acteurs et des partis, pas leurs noms.<br/>
					Créez enfin le graphe qui sera affiché avec D3, en remplissant des champs "source", "target" et "value" de chaque lien, et "id" et "group" de chaque noeud.</p>

					<p>Attention: le graphe obtenu aura un nombre trop élevé de arcs (j'en compte 337377), et votre machine ne tiendra probablement pas la route. Décimez alors votre graphe en ne considérant que les arcs correspondants à plus de N votes conjoints (la visualisation ci-dessus a été obtenue avec N=10, mais il faut attendre près de 2 minutes pour l'obtenir! débugguez avec N=20 au moins, ce qui laisse déjà près de 8000 liens). Si vous avez des problèmes avec block builder, vous pouvez lancer un serveur local en lancant la commande "python -m SimpleHTTPServer 8080" depuis le repertoire de votre fichier html, et en vous connectant ensuite à http://localhost:8080 </p>


				<h4>3. (Optionnel) Affichage du nom des acteurs et partis</h4>
				<p>Changez la fonction "title" pour afficher le nom et le parti des acteurs lorsque la souris survole un noeud. Pour cela, utilisez le deuxième fichier pour retrouver les infos correspondant aux identifiants. </p>
				<p> Le nom du parti <code> json2.export.organes.organe[i].uid</code> se trouve dans:
				<code>
                   json2.export.organes.organe[i].libelle
			     </code>
				</p>
				<p> Similairement, le nom de l'acteur <code>json2.export.acteurs.acteur[i].uid["#text"]</code> se trouve à <code>json2.export.acteurs.acteur[i].etatCivil.ident.prenom</code>.




        <h3>Rendu pour ce TP</h3>

        <p>
					Vous pouvez discuter entre vous, mais le travail se fait et se rend individuellement.
					<b>Soumettre au plus tard mercredi 20/12 à 23h59</b> le block dû par email à nicolas.bonneel@liris.cnrs.fr, ainsi qu'un screenshot de votre visualisation.</a>.
        </p>

			</section>

    </div>
    <script src="../javascripts/scale.fix.js"></script>

</body>
</html>
