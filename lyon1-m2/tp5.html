<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/go.min.js"></script>
	<link rel="stylesheet" type="text/css" href="../stylesheets/styles.css" media="screen">
	<link rel="stylesheet" type="text/css" href="../stylesheets/github-light.css" media="screen">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->


    <title>TP5 DataViz Lyon1 M2 2016</title>
</head>

<body>
		<!-- for highlight.js -->
		<script>hljs.initHighlightingOnLoad();</script>
		<div class="wrapper">
      <header>
			<h1>TP5 DataViz: Données spatiales avec D3.js</h1>
			<p>Université Lyon 1, Master 2, 2016</p>

      </header>

			<section>
				<h3>Objectif du TP</h3>

				<p>Réaliser une carte interactive de la grippe en France comme celle ci-dessous.</p>

        <img src="images/tp5.gif">

				<p>TP noté, voir les instructions de soumission en bas de page.</p>

				<h4>0. Fork du TP4</h4>
					<p>Forker votre TP de la semaine dernière (TP4), pour démarrer proprement.</p>

				<h4>1. Ajout d'un slider temporel</h4>
					<p>Commencer par rajouter un slider qui permettra de naviguer entre les différentes semaines du jeu de données.</p>

					<pre><code>
&lt;div&gt;
  &lt;input id="slider" type="range" value="1" min="1" max="100" step="1" /&gt;
  &lt;span id="week"&gt;week&lt;/span&gt;
&lt;/div&gt;
					</code></pre>

					<p>On ajoutera aussi un élement textuel pour s'assurer que les évènements du slider sont bien capturé par le code javascript plus tard.</p>


				<h4>2. Amélioration du chargement des données</h4>
				<p>Utiliser de queue() pour charger les fichiers de données de manière asynchrone.</p>
				<pre><code>
queue()   // permet de charger les fichiers de manière asynchrone
  .defer(d3.json, "regionsFrance.json")
  .defer(d3.csv, "grippefrance.csv")
  .await(processData);  // une fois les fichiers chargé, la fonction processData
                        // est appelée avec les fichiers en arguments
			  </code></pre>

				<pre><code>function processData(error,francejson,grippedata) {}</code></pre>


				<h4>3. Traitement des données</h4>

				<p>Dans <code>processData</code>:</p>

				<p>Parcourir les données pour identifier le min et le max des valeurs de grippe, et ajuster l'échelle de couleur.</p>

				<p>Ajuster la taille du slider en fonction du nombre de semaines disponibles dans les données (calculer la valeur de numberofweeks):</p>
				<pre><code>d3.select('#slider').attr("max", numberofweeks)</code></pre>

				<p>Injecter les données du fichier csv, dans le fichier json, comme dans le TP4. Mais cette fois ci, à la place d'injecter une valeur données, injecter un tableau de toutes les valeurs. Le code ci-dessous, récupère les valeurs d'une région données sous forme de tableau qu'il suffira d'insérer dans le json.</p>
				<pre><code>Object.values(data[i]);</code></pre>

				<h4>4. Modification des données à afficher</h4>
				<p>Ajouter un listener sur le slider, qui appellera une fonction <code>updateViz</code> en cas de changement, pour mettre à jour la visualisation:</p>

				<pre><code>
d3.select("#slider").on("input", function() {
	updateViz(+this.value);
});
				</code></pre>

				<p>Faire en sorte qu'en cas de changement du slider, le texte affiche la semaine sélectionnée.</p>

				<pre><code>d3.select('#week').html( valeur de la semaine selectionnée );</code></pre>

				<p>Il est possible de récupérer la liste des semaines sous forme de tableau JavaScript, avec la méthode suivante:</p>
				<pre><code>var weeksArray = Object.keys(data[0]);</code></pre>

				<p>Améliorer / reformater l'affichage de la semaine pour qu'il soit plus lisible.</p>

				<p>Appeler la fonction de dessin de la carte <code>drawMap()</code> (voir l'étape suivante).</p>

				<h4>5. Dessiner et mettre à jour la carte</h4>

				<p>Revoir les principes de update et enter en D3 vu dans le 1e TP.</p>

				<p>Dessiner la carte comme dans le TP4, avec <code>carte.enter()</code>.</p>
				<p>Gérer la mise à jour de la carte, en partant du code ci-dessous. <b>NB: la mise à jour ne demande pas de tout redessiner.</b></p>


				<pre><code>
function drawMap(json, currentWeek) {
  carte = svg.selectAll("path")
    .data(json.features);

  // code en cas de mise a jour de la carte / de changement de semaine
  carte
    .attr("class", "update")
    ...

  // code pour la creation de la carte quand les donnees sont chargees la 1e fois.
  carte.enter()
    .append("path")
    .attr("class", "enter")
    ...
}
				</code></pre>

				<h4>6. Chargement du jeu de données complet</h4>
				<p>Passer des données de 2014 à <a href="data/GrippeFrance2003-15.csv">celles de 2003 - 2005</a>.</p>


				<h4>7. Pour les courageux (facultatif)</h4>
				<p>Rajouter une légende, en vous inspirant par exemple <a href="http://bl.ocks.org/weiglemc/6185069"> de ce block</a></p>

        <h3>Rendu pour ce TP</h3>

        <p>
					Vous pouvez discuter entre vous, mais le travail se fait et se rend individuellement.
					<b>Soumettre au plus tard mercredi 7/12 à 23h59</b> le block du via <a href="https://goo.gl/forms/karQU29cs6KX9V3i2">le formulaire suivant</a>.
        </p>

			</section>

    </div>
    <script src="javascripts/scale.fix.js"></script>

</body>
</html>
